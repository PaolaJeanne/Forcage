{
	"info": {
		"_postman_id": "1008810f-7ad5-45e9-b5d4-5a22bcf60e61",
		"name": "Forcage - API Banking",
		"description": "Collection Postman pour l'API de gestion bancaire avec workflows complets",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "37948414",
		"version": "2.0.0"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{auth_token}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "api_version",
			"value": "api/v1",
			"type": "string"
		},
		{
			"key": "auth_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "demande_id",
			"value": "",
			"type": "string"
		}
	],
	"event": [
		{
			"listen": "test",
			"script": {
				"exec": [
					"// Tests communs pour toutes les r√©ponses",
					"pm.test(\"Status code is 2xx\", function () {",
					"    pm.expect(pm.response.code).to.be.oneOf([200, 201, 204]);",
					"});",
					"",
					"// Sauvegarde automatique du token JWT pour les r√©ponses de login",
					"if (pm.response.code === 200 && pm.request.url.path.includes(\"login\")) {",
					"    const responseData = pm.response.json();",
					"    if (responseData.token) {",
					"        pm.collectionVariables.set(\"auth_token\", responseData.token);",
					"        pm.environment.set(\"auth_token\", responseData.token);",
					"        console.log(\"Token JWT sauvegard√©: \", responseData.token.substring(0, 50) + \"...\");",
					"    }",
					"    if (responseData.userId) {",
					"        pm.collectionVariables.set(\"user_id\", responseData.userId);",
					"    }",
					"}"
				],
				"type": "text/javascript"
			}
		}
	],
	"item": [
		{
			"name": "üìã 1. Pr√©-requis & Configuration",
			"item": [
				{
					"name": "üîÑ Initialiser les variables",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// R√©initialiser les variables si n√©cessaire",
									"console.log(\"URL de base: \" + pm.variables.get(\"base_url\"));",
									"console.log(\"Token actuel: \" + (pm.variables.get(\"auth_token\") ? \"D√©fini\" : \"Non d√©fini\"));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": [
								"{{base_url}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "üìä Tester la connexion API",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"health"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üîê 2. Authentification",
			"description": "Gestion des utilisateurs et authentification",
			"item": [
				{
					"name": "üìù 2.1. Inscription Client",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nom\": \"Mike\",\n    \"prenom\": \"Ondo\",\n    \"email\": \"mike.ondo@client.com\",\n    \"password\": \"Password123!\",\n    \"telephone\": \"+237657655887\",\n    \"numeroCompte\": \"CM123456789\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/{{api_version}}/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "üë• 2.2. Connexion par r√¥le",
					"item": [
						{
							"name": "üë§ Client - Mike Ondo",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"mike.ondo@client.com\",\n    \"password\": \"Password123!\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "üëî Conseiller",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"conseiller@banque.com\",\n    \"password\": \"Test123!\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "üìä Gestionnaire Risques",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"risques@banque.com\",\n    \"password\": \"Test123!\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "üëë Administrateur",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"email\": \"admin@banque.com\",\n    \"password\": \"Admin123!@#\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/login",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"login"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "üë§ 2.3. Gestion du profil",
					"item": [
						{
							"name": "üìã Obtenir le profil",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/profile",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"profile"
									]
								}
							},
							"response": []
						},
						{
							"name": "‚úèÔ∏è Mettre √† jour le profil",
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"nom\": \"Karl\",\n    \"prenom\": \"Max\",\n    \"telephone\": \"+237699674977\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/profile",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"profile"
									]
								}
							},
							"response": []
						},
						{
							"name": "üîê Changer le mot de passe",
							"request": {
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"oldPassword\": \"Test123!\",\n    \"newPassword\": \"NewPassword123!\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/auth/change-password",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"auth",
										"change-password"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "üìã 3. Workflow - Demandes",
			"description": "Workflow complet de cr√©ation et traitement des demandes",
			"item": [
				{
					"name": "üë§ 3.1. Client - Cr√©ation demande",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Sauvegarder l'ID de la demande cr√©√©e",
									"if (pm.response.code === 201) {",
									"    const responseData = pm.response.json();",
									"    if (responseData._id || responseData.id) {",
									"        const demandeId = responseData._id || responseData.id;",
									"        pm.collectionVariables.set(\"demande_id\", demandeId);",
									"        pm.environment.set(\"demande_id\", demandeId);",
									"        console.log(\"ID de demande sauvegard√©: \" + demandeId);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "multipart/form-data",
								"disabled": true
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "motif",
									"value": "D√©blocage urgent pour paiement fournisseur",
									"type": "text",
									"description": "Motif de la demande"
								},
								{
									"key": "montant",
									"value": "500000",
									"type": "text",
									"description": "Montant en XAF"
								},
								{
									"key": "dateEcheance",
									"value": "{{$timestamp 30 days}}",
									"type": "text",
									"description": "Date d'√©ch√©ance (30 jours)"
								},
								{
									"key": "compteDebit",
									"value": "01123456789",
									"type": "text"
								},
								{
									"key": "compteNumero",
									"value": "CLIENT001",
									"type": "text"
								},
								{
									"key": "devise",
									"value": "XAF",
									"type": "text"
								},
								{
									"key": "typeOperation",
									"value": "VIREMENT",
									"type": "text",
									"description": "VIREMENT, CHEQUE, etc."
								},
								{
									"key": "commentaireInterne",
									"value": "Client fiable, historique bon",
									"type": "text"
								},
								{
									"key": "justificatifs",
									"type": "file",
									"src": "",
									"description": "Document justificatif"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/{{api_version}}/demandes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"demandes"
							]
						}
					},
					"response": []
				},
				{
					"name": "üì§ 3.2. Soumettre la demande",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "{{base_url}}/{{api_version}}/demandes/{{demande_id}}/soumettre",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"demandes",
								"{{demande_id}}",
								"soumettre"
							]
						}
					},
					"response": []
				},
				{
					"name": "üëî 3.3. Conseiller - Lister demandes",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/{{api_version}}/demandes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"demandes"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚úÖ 3.4. Conseiller - Traiter demande",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"action\": \"VALIDER\",\n    \"commentaire\": \"Demande valid√©e apr√®s v√©rification des justificatifs\",\n    \"montantAutorise\": 340000\n}"
						},
						"url": {
							"raw": "{{base_url}}/{{api_version}}/demandes/{{demande_id}}/traiter",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"demandes",
								"{{demande_id}}",
								"traiter"
							]
						}
					},
					"response": []
				},
				{
					"name": "üìä 3.5. Risques - Validation finale",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"action\": \"VALIDER\",\n    \"commentaire\": \"Analyse risques OK, demande approuv√©e\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/{{api_version}}/demandes/{{demande_id}}/traiter",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"demandes",
								"{{demande_id}}",
								"traiter"
							]
						}
					},
					"response": []
				},
				{
					"name": "üë§ 3.6. Client - Voir ses demandes",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/{{api_version}}/demandes/mes-demandes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"demandes",
								"mes-demandes"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üí¨ 4. Messagerie",
			"item": [
				{
					"name": "üë• Voir l'√©quipe",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/{{api_version}}/chat/team",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"chat",
								"team"
							]
						}
					},
					"response": []
				},
				{
					"name": "üì® Envoyer message",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"recipientId\": \"{{user_id}}\",\n    \"message\": \"Bonjour, j'aimerais savoir o√π vous en √™tes avec mon dossier de demande.\",\n    \"demandeId\": \"{{demande_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/{{api_version}}/chat/direct",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"chat",
								"direct"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üëë 5. Administration",
			"item": [
				{
					"name": "üë• 5.1. Gestion utilisateurs",
					"item": [
						{
							"name": "‚ûï Cr√©er utilisateur",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{auth_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"nom\": \"Albert\",\n    \"prenom\": \"Brunel\",\n    \"email\": \"risques@banque.com\",\n    \"password\": \"Test123!\",\n    \"telephone\": \"+237698789867\",\n    \"role\": \"rm\",\n    \"agence\": \"Agence Centrale\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/admin/users",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"admin",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "üìã Lister utilisateurs",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{auth_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/{{api_version}}/admin/users",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"admin",
										"users"
									]
								}
							},
							"response": []
						},
						{
							"name": "üîÑ Modifier r√¥le",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{auth_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"role\": \"conseiller\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/{{api_version}}/admin/users/{{user_id}}/role",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"admin",
										"users",
										"{{user_id}}",
										"role"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "üìä 5.2. Monitoring & Audit",
					"item": [
						{
							"name": "üìà Dashboard",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{auth_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/{{api_version}}/dashboard",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"dashboard"
									]
								}
							},
							"response": []
						},
						{
							"name": "üìã Logs d'audit",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{auth_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/{{api_version}}/audit/logs",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"{{api_version}}",
										"audit",
										"logs"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "üß™ 6. Tests & Utilitaires",
			"item": [
				{
					"name": "üîî Test notifications",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/test-notification",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"test-notification"
							]
						}
					},
					"response": []
				},
				{
					"name": "üîÑ G√©n√©rer donn√©es test",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"action\": \"generate-test-data\",\n    \"count\": 5\n}"
						},
						"url": {
							"raw": "{{base_url}}/{{api_version}}/utils/generate-data",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"{{api_version}}",
								"utils",
								"generate-data"
							]
						}
					},
					"response": []
				}
			]
		}
	]
}